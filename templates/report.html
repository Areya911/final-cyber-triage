{% extends "base.html" %}
{% block content %}
<h2>Report Preview â€” Case <small class="text-muted">{{ case_id }}</small></h2>

<div class="mb-3">
  <strong>Case Info:</strong>
  <pre>{{ case_info | tojson(indent=2) }}</pre>
</div>

<h5>Artifacts</h5>
{% if artifacts and artifacts|length > 0 %}
  <div class="table-responsive">
    <table class="table table-bordered table-sm">
      <thead>
        <tr>
          <th>Artifact ID</th>
          <th>Filename</th>
          <th>Uploaded By</th>
          <th>Uploaded At</th>
          <th>Size</th>
          <th>Analysis</th>
        </tr>
      </thead>
      <tbody>
        {% for a in artifacts %}
          <tr>
            <td style="font-family:monospace">{{ a.artifact_id }}</td>
            <td>{{ a.original_filename }}</td>
            <td>{{ a.uploaded_by }}</td>
            <td>{{ a.uploaded_at }}</td>
            <td>{{ a.size_bytes }}</td>
            <td>
              {% if a.analysis %}
                <pre style="max-height:120px; overflow:auto;">{{ a.analysis | tojson(indent=2) }}</pre>
              {% else %}
                <span class="text-muted">No analysis</span>
              {% endif %}
            </td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
{% else %}
  <div class="alert alert-warning">No artifacts to include in the report for this case.</div>
{% endif %}

<!-- Report actions -->
<div class="mt-3">
  <a class="btn btn-primary" href="{{ url_for('api_manifest', case_id=case_id) }}">Download manifest JSON</a>
</div>
{% endblock %}
